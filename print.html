<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lab Notebook</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Systems Programming</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="systems_programming/branchless.html"><strong aria-hidden="true">2.1.</strong> branchless</a></li><li class="chapter-item expanded "><a href="systems_programming/allocators.html"><strong aria-hidden="true">2.2.</strong> allocators</a></li><li class="chapter-item expanded "><a href="systems_programming/concurrency.html"><strong aria-hidden="true">2.3.</strong> concurrency</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Notes</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="notes/writing-and-talking.html"><strong aria-hidden="true">3.1.</strong> Writing and Talking</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Lab Notebook</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>This is the lab notebook of Brian L. Troutwine, or
<a href="https://github.com/blt/">blt</a> depending on if you know me in the flesh or
online. I like to play optimization games and program computers and have managed
to make a living, so far, at doing both. I keep busy with a bunch of side
projects and research interests that don't necessarily involve computers and
figured that a less haphazard scheme for keeping my notes would be valuable to
me and probably of interest to other folks. I've took a lot of inspiration from
<a href="https://lab.jamesmunns.com/">James Munns</a> who took inspiration from
<a href="https://lab.whitequark.org/">whitequark</a>.</p>
<h1><a class="header" href="#branchless-programming" id="branchless-programming">Branchless Programming</a></h1>
<p>Modern processors have very deep pipelines, making branch mispredictions
costly. Compilers are pretty good at removing branches but not perfect at
it. Here's a list of interesting things I've read on &quot;branchless&quot; programming:</p>
<ul>
<li><a href="https://jaredgorski.org/notes/zett-branchless-programming-2020-08-11-1532/">Branchless programming, an article</a></li>
<li><a href="https://github.com/alpbintug/Branchless-programming">Branchless Programming, a Github repo</a></li>
<li><a href="https://arxiv.org/pdf/1602.06426.pdf">A loopless and branchless <code>O(1)</code> algorithm to generate the nextDyck word</a></li>
<li><a href="https://hbfs.wordpress.com/2008/08/05/branchless-equivalents-of-simple-functions/">Branchless Equivalents of Simple Functions</a></li>
<li><a href="https://bluejekyll.github.io/blog/rust/2018/01/10/branchless-rust.html">Branchless Rust</a></li>
<li><a href="https://www.blueraja.com/blog/285/branchless-conditionals-compiler-optimization-technique">Branchless Conditionals (Compiler Optimization Technique)</a></li>
<li><a href="https://www.infoq.com/articles/making-code-faster-taming-branches/">Making Code Faster: Taming Branches</a></li>
<li><a href="https://www.chessprogramming.org/Avoiding_Branches">Chess Programming Wiki: Avoiding Branches</a></li>
</ul>
<p>The Chess Programming wiki is probably the most obsessive piece in this list
with additional references around the internet. I mean this in a good way. Chess
folks do some of the most unusual high-performance programming around.</p>
<h1><a class="header" href="#allocators" id="allocators">Allocators</a></h1>
<p>An &quot;allocator&quot; is a library that sets aside an area in computer memory -- called
the &quot;heap&quot; as opposed to the &quot;stack&quot; and &quot;static&quot; memory -- for use by some
other program. An allocator may or may not keep track of these &quot;allocations&quot; in
its private mechanism and it may or may not allow for callers to &quot;return&quot;
allocations to the allocator, thus freeing up that memory for us by another
caller. If you've ever called <code>malloc</code>, <code>free</code> et all in C you've interacted
with an allocator. If you've used a language with a runtime that manages memory
you have done so indirectly. If you've only programmed for embedded devices that
manage memory themselves and allocate only at startup then, well, kudos.</p>
<p>The third chapter of my <a href="systems_programming/../notes/writing-and-talking.html#systems-programming-for-normal-people">new
book</a>
introduces the memory heirarchy of a computer, starting with static memory,
working into the stack and out to the heap. By the end of the chapter the
reader's got the ability to swap in new allocators but no ability to write them,
on account of the book hasn't built up any expertise in thread-safe
programming. Next chapter aims to teach that very thing and, in so doing, will
build up several allocators. We'll see how successful I am. Anyhow, I've been
going back through the literature on allocators. Here's what's interesting I've
turned up so far, in no particular order:</p>
<ul>
<li>Andrei Alexandrescu: <a href="http://erdani.org/publications/cuj-2005-12.pdf">Policyâ€“Based Memory Allocation</a></li>
<li>David Gay et al: <a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.483.9985&amp;rep=rep1&amp;type=pdf">Memory Management with Explicit Regions</a></li>
<li>Emery Berger et al: <a href="https://people.cs.umass.edu/%7Eemery/publications/berger-pldi2001.pdf">Composing High-Performance Memory Allocators</a></li>
<li>Jason Evans: <a href="https://www.bsdcan.org/2006/papers/jemalloc.pdf">A Scalable Concurrent <code>malloc(3)</code> Implementation for FreeBSD</a></li>
<li>Jeff Bonwick: <a href="https://www.usenix.org/conference/2001-usenix-annual-technical-conference/magazines-and-vmem-extending-slab-allocator-many">Magazines and Vmem: Extending the Slab Allocator to Many CPUs and Arbitrary Resources</a></li>
<li>Jeff Bonwick: <a href="https://people.eecs.berkeley.edu/%7Ekubitron/courses/cs194-24-S14/hand-outs/bonwick_slab.pdf">The Slab Allocator: An Object-Caching Kernel Memory Allocator</a></li>
<li>Maged Michael: <a href="https://www.cs.tufts.edu/%7Enr/cs257/archive/maged-michael/pldi-2004.pdf">Scalable Lock-Free Dynamic Memory Allocation</a></li>
<li>Paul Lietar et al: <a href="https://www.microsoft.com/en-us/research/uploads/prod/2020/04/snmalloc.pdf">snmalloc: A Message Passing Allocator</a></li>
<li>Trishul M. Chilimbi et al: <a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/12/definition_distr.pdf">Cache-Conscious Structure Definition</a></li>
</ul>
<h1><a class="header" href="#concurrency" id="concurrency">Concurrency</a></h1>
<p>This is probably my favorite area of systems programming. It's a niche that
rewards an understanding of hardware, algorithms and the internal life of
operating systems. Great fun.</p>
<h2><a class="header" href="#exclusion" id="exclusion">Exclusion</a></h2>
<ul>
<li><a href="https://matklad.github.io/2020/01/02/spinlocks-considered-harmful.html">Spinlocks Considered Harmful</a></li>
</ul>
<h1><a class="header" href="#writing-and-talking" id="writing-and-talking">Writing and Talking</a></h1>
<p>Over the years I've wrote and talked about a number of things, mostly
technical. I haven't been very careful about keeping an index of these things,
since to me they feel like a kind of rocket exhaust. Anyhow.</p>
<h2><a class="header" href="#writings" id="writings">Writings</a></h2>
<h3><a class="header" href="#build-good-software-of-politics-and-methods" id="build-good-software-of-politics-and-methods">&quot;Build Good Software: Of Politics and Methods&quot;</a></h3>
<p>I wrote this essay in 2017 to accompany a keynote I was invited to give at
Lambda Days. I think a good deal of the software industry is dominated by a kind
of unreflective techno-utopianism which I find to be both deleterious to the
public good and harmful to the process of becoming good at writing software as a
civilization. There are seeds in this work of my later interest in communal
anti-mammon Christian social thought, though I didn't really have a sense of
this at the time of writing. That would only come after a serious reading of
Pr. Dietrich Bonhoeffer's
<a href="https://en.wikipedia.org/wiki/The_Cost_of_Discipleship">&quot;Nachfolge&quot;</a>.</p>
<p>Anyhow, the essay is still something that I'm proud of and I'd probably approach
it in a broadly similar fashion today.</p>
<p>You can read it online <a href="https://blog.troutwine.us/2017/02/10/build-good-software/">here</a></p>
<h3><a class="header" href="#hands-on-concurrency-with-rust" id="hands-on-concurrency-with-rust">&quot;Hands-On Concurrency with Rust&quot;</a></h3>
<p>This is my first book for Packt. You can find it
<a href="https://www.packtpub.com/product/hands-on-concurrency-with-rust/9781788399975">here</a>. I
wrote about the process of writing it
<a href="https://blog.troutwine.us/2018/06/07/hands-on-concurrency-with-rust/">here</a>,
why and how I did it. Fun project.</p>
<h3><a class="header" href="#systems-programming-for-normal-people" id="systems-programming-for-normal-people">&quot;Systems Programming for Normal People&quot;</a></h3>
<p>This is my in-progress book for No Starch press. The idea is to introduce
systems programming for practicing software engineers that may not have had
opportunity to work down-stack but would like an inroads. I am also trying to
orient the book toward what I see as the reality of systems programming today:
migration of complex kernel workflows into a hybrid userspace model,
minimization of memory copies, containerization and distribution.</p>
<h2><a class="header" href="#talks" id="talks">Talks</a></h2>
<h3><a class="header" href="#the-charming-genius-of-the-apollo-guidance-computer" id="the-charming-genius-of-the-apollo-guidance-computer">The Charming Genius of the Apollo Guidance Computer</a></h3>
<p>This is probably my most watched talk. I had previously spoken at Erlang Factory
conferences on, well, Erlang things and was invited by the Code Mesh folks to
let loose a little. I was very interested in the hardware of the Apollo project
at the time -- as a result of David Mindell's &quot;Digital Apollo&quot; book -- and spoke
about the architecture of the Apollo guidance computer, a quirky little machine
even for the time. There are some factual errors in the talk but overall I'm
still a fan. London is quite a bit around the world from Berkeley, California
and I was <em>very</em> tired. I've subsequently learned how to hide my notes from the
audience, allowing me to avoid weird little goofs, but I hadn't hit on them here
yet. Ah well, such is the peril of live performance. Amusingly this is one of
the few talks I've given twice and the second time I <em>had</em> hit on my note method
but the secondary screen failed, denying me my notes yet again.</p>
<p>You can view this talk
<a href="https://www.youtube.com/watch?v=xY45YE7ggng">online</a>. The second version is
<a href="https://systemswe.love/videos/the-charming-genius-of-the-apollo-guidance-computer">here</a>.</p>
<h3><a class="header" href="#getting-uphill-on-a-candle-crushed-spines-detached-retinas-and-one-small-step" id="getting-uphill-on-a-candle-crushed-spines-detached-retinas-and-one-small-step">Getting Uphill on a Candle: Crushed Spines, Detached Retinas and One Small Step</a></h3>
<p>This is my favorite talk I've ever given. In 40 minutes I give a history of
aeronautics from the Wright Brothers' flight through to the Moon landing. I
recall my goal at the time was to describe how long-term technological change
happens -- something I'm very interested in -- as well as push just how much
information I could deliver to an audience in one sitting. If I remember
correctly there are some 200 slides in the talk, so it's more like a very slow
animation. You can view this talk
<a href="https://www.youtube.com/watch?v=3lMYbkqPWFE">online</a>.</p>
<p>I later gave a <a href="https://en.wikipedia.org/wiki/PechaKucha">PechaKucha</a> variant of
this talk, but not in public.</p>
<h3><a class="header" href="#build-good-software-of-politics-and-methods-1" id="build-good-software-of-politics-and-methods-1">Build Good Software: Of Politics and Methods</a></h3>
<p>More detail in <a href="notes/writing-and-talking.html#build-good-software-of-politics-and-methods">this section</a>.</p>
<p>You can view this talk
<a href="https://www.youtube.com/watch?v=fdO4VN1IDI0&amp;list=PLPzMpGTwiBD0TBDW2oMefYg99g46TG1w5&amp;index=9">online</a>.</p>
<h3><a class="header" href="#why-things-fail" id="why-things-fail">Why Things Fail</a></h3>
<p><a href="https://twitter.com/redrapids">Bruce Tate</a> and I were doing a video series for
a while called &quot;Why Things Fail&quot;. One of my research interests is the failure of
complex systems and this series is me and Bruce having a conversation about one
serious failure in-depth. We've recorded three videos so far. We had planned to
talk about the <a href="https://en.wikipedia.org/wiki/Dust_Bowl">Dust Bowl</a> but that got
interrupted.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=9CsMW1pJmpI">Why Things Fail: The Bug Heard 'round the World</a></li>
<li><a href="https://www.youtube.com/watch?v=OiTHSEYvWEs">Why Things Fail: The Great Molasses Flood of 1919</a></li>
<li><a href="https://www.youtube.com/watch?v=hco91AtgFTA">Why Things Fail (and what we can do about it)</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
