<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Debugging - Lab Notebook</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Programming Techniques</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming_techniques/debugging.html" class="active"><strong aria-hidden="true">2.1.</strong> Debugging</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Systems Programming</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../systems_programming/branchless.html"><strong aria-hidden="true">3.1.</strong> Branchless</a></li><li class="chapter-item expanded "><a href="../systems_programming/allocators.html"><strong aria-hidden="true">3.2.</strong> Allocators</a></li><li class="chapter-item expanded "><a href="../systems_programming/concurrency.html"><strong aria-hidden="true">3.3.</strong> Concurrency</a></li><li class="chapter-item expanded "><a href="../systems_programming/performance.html"><strong aria-hidden="true">3.4.</strong> Measuring Performance</a></li><li class="chapter-item expanded "><a href="../systems_programming/testing.html"><strong aria-hidden="true">3.5.</strong> Testing</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Notes</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../notes/writing-and-talking.html"><strong aria-hidden="true">4.1.</strong> Writing and Talking</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Lab Notebook</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#debugging" id="debugging">Debugging</a></h1>
<p>I've got a particular way I go about debugging systems, less about tools and
more about process. I'm not totally sure how to go about explaining it, that
said, hence this note.</p>
<h2><a class="header" href="#what-debugging-is" id="what-debugging-is">What Debugging Is</a></h2>
<p>Debugging is the process of repairing your mental model of a software
system. That is, you might <em>believe</em> that your piece of software behaves some
way for some inputs but can <em>observe</em> that it does not. Coming to an
understanding of exactly how and why your mental model differs is the end goal
of debugging. You may, also, want to come up with a way of adjusting the
software to match your incorrect model, but that's a secondary goal. Implicit in
this are some assumptions:</p>
<ul>
<li>
<p>Software and the computers they run on are <em>machines</em> and can be understood as
such. They have no self-animation and, while not deterministic, obey a limited
set of rules in their operation.</p>
</li>
<li>
<p>Software and the computers they run on are <em>human artifacts</em> and were meant to
be understood by humans.</p>
</li>
<li>
<p><em>Empiricism</em> is the name of the game. Your reasoning -- the mental model --
has to be informed by experimental data. Your reasoning is faulty and can't be
trusted in isolation. Your experiments are also faulty but in a different
degree.</p>
</li>
<li>
<p><em>Magical thinking</em> is a curse and we all participate in it. While computers
are simply machines following rules their complexity is staggering and
everyone, at some point, has to cut an abstraction line and consider
everything past that line a magical black box with behaviors that may or may
not be reflective of the function of that part of things. If your mental model
of one of these black box areas is wildly wrong but involved in your mental
model for the component under discussion you're going to have a bad time.</p>
</li>
<li>
<p>Debugging is best done as a <em>social activity</em>. My areas of magical thinking are
not yours; my mental model is not yours. Involving other people in debugging
work -- especially if they are familiar with but not close to the problem --
almost always bears fruit.</p>
</li>
<li>
<p>Mental models are good, testable models are better. In so far as is practical
if you're investing in testing try to invest in randomized model approaches,
like QuickCheck. Done right you'll be able to translate your mental model into
code and lean on the computer to find defects in it.</p>
</li>
</ul>
<h2><a class="header" href="#how-i-debug" id="how-i-debug">How I Debug</a></h2>
<p>I debug following this rough process.</p>
<ol start="0">
<li>
<p>Get a statement from people familiar with the system about how things are
going wrong, ideally something you can reproduce the issue with but, if not,
at least something to point you in the general direction of things being
goofy.</p>
</li>
<li>
<p>Isolate known good areas of the program from known bad. Add tests, telemetry
or drop into a live debugger to find seams in your program where your model
for the program holds versus where it does not. If you're lucky the resulting
deviant bit is pretty small, but more often than not it isn't. At this point
you should have the ability to reproduce an issue -- maybe not <em>the</em> issue --
against the isolated part of the program, preferably in an automated way.</p>
</li>
<li>
<p>Talk with people that wrote the deviant bit of the program, if it isn't
you. Are they surprised by its behavior? If not, they may have intentionally
programmed the isolated chunk to act this way intentionally. Why? If they're
surprised, see if they have ideas for how to isolate parts of the chunk
further. Ask for a tour by them of the chunk. Authors have a lot of deep
insight into a program.</p>
</li>
<li>
<p>Read the source code for the program chunk, taking special care to note how
your inputs from your reproducible issue are flowed through the code. This,
hopefully, will give you rough ideas on where the program can be further
subdivided.</p>
</li>
<li>
<p>If you found areas to subdivide, go back to step 1. Some of your new
sub-chunk programs will work perfectly in accord with your mental model for
them, others will not. Ideally, only one will not, in which case there is
only one deviance, but more often that not you'll find several working in
concern. Be <em>sure</em> to work only one avenue of exploration at a time. Have the
discipline to change only one thing at a time to keep your experiments clean.</p>
</li>
<li>
<p>If you're stuck, take a walk. Take a nap. Pack it away for the day. Our minds
need time to rest and there's only so much that can be done in one continuous
marathon, however much we mythologize the lone, sleepless hacker. If these
things don't work, explain your results so far to someone else. The
&quot;confessional method&quot; of debugging will often trigger new ideas and, more,
the person you're talking with will have fresh notions.</p>
</li>
<li>
<p>If you've subdivided the program into fine parts and have a reliable, ideally
automated ways of demonstrating how your mental model is off,
congratulations, you've debugged the program. If you find that the &quot;leaves&quot;
of this subdivision process are perfectly fine but it's some integration of
them together that's dodgy also congratulations. Software faults often occur
at interfaces and you should, at this point, have some method for
demonstrating how these combined components don't quite fit right together.</p>
</li>
<li>
<p>Tell folks about your findings. It may be that the program is actually
behaving correctly and the sense of what the program should do is off, it
might be that it's just buggy and needs to be repaired. Usually by
demonstrating an issue you've also demonstrated some kind of avenue for
fixing it, but laying out your results to other people will often bear fruit
in this regard that you, now very close to the program, will not have
considered.</p>
</li>
</ol>
<h2><a class="header" href="#some-stray-thoughts" id="some-stray-thoughts">Some Stray Thoughts</a></h2>
<p>I cannot emphasize enough how important it is in this process to do only one
thing at a time. Explore one chunk of the program at once, change only one thing
at a time, keep as many of the conditions in which failure is first described as
intact as possible until you can <em>demonstrate</em> they're co-incident and not
essential features of the problem. It's often tempting to change multiple things
at once because you &quot;know&quot; that the program won't be affected, but it's just
plain wrong to assume that, sure, my model of how the program work is wrong over
here but over there it's accurate. I can't tell you how many debugging sessions
I've entered into with people and requested, just for giggles, to probe
something they &quot;know&quot; is reliable to find that it's actually the thing that's
goofed. I can't tell you how many times I've done this to myself.</p>
<p>Because we're dealing with rule bound machines it might happen that you need to
unbox the mechanism in one of your black box areas, especially if you don't have
access to a domain expert to talk with.</p>
<p>Things take the time they take. In a world infected with Taylorism there is a
strong sense in this kind of exploration work that the &quot;clock is ticking&quot; and
they better get results fast. May be that there's time pressure but that's an
independent and uncontrollable concern from the time you need to reason and
perform experiments, chat with colleagues. If you're under no external time
pressure but still feel an urgent need to get results, maybe think on that. We
are not, ourselves, repeatable mechanisms.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../introduction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../systems_programming/branchless.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../introduction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../systems_programming/branchless.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
