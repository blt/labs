<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Allocators - Lab Notebook</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Programming Techniques</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming_techniques/debugging.html"><strong aria-hidden="true">2.1.</strong> Debugging</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Systems Programming</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../systems_programming/branchless.html"><strong aria-hidden="true">3.1.</strong> Branchless</a></li><li class="chapter-item expanded "><a href="../systems_programming/allocators.html" class="active"><strong aria-hidden="true">3.2.</strong> Allocators</a></li><li class="chapter-item expanded "><a href="../systems_programming/concurrency.html"><strong aria-hidden="true">3.3.</strong> Concurrency</a></li><li class="chapter-item expanded "><a href="../systems_programming/performance.html"><strong aria-hidden="true">3.4.</strong> Measuring Performance</a></li><li class="chapter-item expanded "><a href="../systems_programming/testing.html"><strong aria-hidden="true">3.5.</strong> Testing</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Notes</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../notes/writing-and-talking.html"><strong aria-hidden="true">4.1.</strong> Writing and Talking</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Lab Notebook</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#allocators" id="allocators">Allocators</a></h1>
<p>An &quot;allocator&quot; is a library that sets aside an area in computer memory -- called
the &quot;heap&quot; as opposed to the &quot;stack&quot; and &quot;static&quot; memory -- for use by some
other program. An allocator may or may not keep track of these &quot;allocations&quot; in
its private mechanism and it may or may not allow for callers to &quot;return&quot;
allocations to the allocator, thus freeing up that memory for us by another
caller. If you've ever called <code>malloc</code>, <code>free</code> et all in C you've interacted
with an allocator. If you've used a language with a runtime that manages memory
you have done so indirectly. If you've only programmed for embedded devices that
manage memory themselves and allocate only at startup then, well, kudos.</p>
<p>The third chapter of my <a href="../notes/writing-and-talking.html#systems-programming-for-normal-people">new
book</a>
introduces the memory heirarchy of a computer, starting with static memory,
working into the stack and out to the heap. By the end of the chapter the
reader's got the ability to swap in new allocators but no ability to write them,
on account of the book hasn't built up any expertise in thread-safe
programming. Next chapter aims to teach that very thing and, in so doing, will
build up several allocators. We'll see how successful I am. Anyhow, I've been
going back through the literature on allocators. Here's what's interesting I've
turned up so far, in no particular order:</p>
<ul>
<li>Andrei Alexandrescu: <a href="http://erdani.org/publications/cuj-2005-12.pdf">Policyâ€“Based Memory Allocation</a></li>
<li>David Gay et al: <a href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.483.9985&amp;rep=rep1&amp;type=pdf">Memory Management with Explicit Regions</a></li>
<li>Emery Berger et al: <a href="https://people.cs.umass.edu/%7Eemery/publications/berger-pldi2001.pdf">Composing High-Performance Memory Allocators</a></li>
<li>Jason Evans: <a href="https://www.bsdcan.org/2006/papers/jemalloc.pdf">A Scalable Concurrent <code>malloc(3)</code> Implementation for FreeBSD</a></li>
<li>Jeff Bonwick: <a href="https://www.usenix.org/conference/2001-usenix-annual-technical-conference/magazines-and-vmem-extending-slab-allocator-many">Magazines and Vmem: Extending the Slab Allocator to Many CPUs and Arbitrary Resources</a></li>
<li>Jeff Bonwick: <a href="https://people.eecs.berkeley.edu/%7Ekubitron/courses/cs194-24-S14/hand-outs/bonwick_slab.pdf">The Slab Allocator: An Object-Caching Kernel Memory Allocator</a></li>
<li>Maged Michael: <a href="https://www.cs.tufts.edu/%7Enr/cs257/archive/maged-michael/pldi-2004.pdf">Scalable Lock-Free Dynamic Memory Allocation</a></li>
<li>Paul Lietar et al: <a href="https://www.microsoft.com/en-us/research/uploads/prod/2020/04/snmalloc.pdf">snmalloc: A Message Passing Allocator</a></li>
<li>Trishul M. Chilimbi et al: <a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/12/definition_distr.pdf">Cache-Conscious Structure Definition</a></li>
</ul>
<h2><a class="header" href="#rust-allocators" id="rust-allocators">Rust Allocators</a></h2>
<p>These are interesting Rust allocators that I'm aware of:</p>
<ul>
<li><a href="https://github.com/jamesmunns/bitpool/">bitpool</a></li>
<li>mycelium's <a href="https://github.com/hawkw/mycelium/blob/main/alloc/src/buddy.rs">buddy</a></li>
<li><a href="https://github.com/rustwasm/wee_alloc/tree/HEAD/wee_alloc">wee_alloc</a></li>
<li><a href="https://github.com/paritytech/substrate/tree/HEAD/primitives/allocator">sp-allocator</a></li>
<li><a href="https://github.com/wackywendell/basicalloc">basicalloc</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../systems_programming/branchless.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../systems_programming/concurrency.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../systems_programming/branchless.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../systems_programming/concurrency.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
